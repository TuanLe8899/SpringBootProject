<!DOCTYPE html>
<html lang="vi" 
	xmlns="http://www.w3.org/1999/xhtml"
    xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<div class="container">
		
		<div>
			<!-- search box -->
			<form action="" method="get" style="display:block; width:100%;">
				<label for="search" style="display: inline-block; width: 50px;">Search:</label>
				<input type="search" name="search" id="search" 
					placeholder="Enter product name..."
					style="width: calc(100% - 160px)"
					value="<%=request.getParameter("search")!=null ? 
								request.getParameter("search") : "" %>">
				<input type="submit" value="Search" class="search-button">
			</form>
			<!-- end search box -->
			
			<!-- filter by category -->
			<form action="" method="get" id="form2" style="display: inline-block;">
			    <label for="category" 
			    	style="display: inline-block; width: 130px">
			    	Filter by category:</label>
			    <select id="category" name="category" class="field-sort-filter" onchange="form2.submit()">
			      <option value="all" selected="selected">All</option>
			      <option value="1">1</option>
			    </select>
			</form>
			<!-- end filter by category -->
			
			<!-- filter by price -->
			<form action="" method="get">
				<label for="pricefrom"
					style="display: inline-block; width: 130px">
					Filter by price:</label>
				<input type="text" name="pricefrom" id="pricefrom"
					placeholder="from..." 
					class="field-sort-filter">
								
				<label for="priceto">to: </label>
				<input type="text" name="priceto" id="priceto"
					placeholder="to..." 
					class="field-sort-filter">
				<input type="submit" value="Apply" class="apply-button">
			</form>
			<!-- end filter by price -->
		
			<!-- selection sort -->
			<div>
				<h3 style="display:inline-block">Product</h3>
				<form action="" method="get" id="form1" style="float: right">
					<% if(request.getParameter("category")!=null) { %>
					<input type="hidden" name="category" value="<%=request.getParameter("category")%>">
					
					<% } else if (request.getParameter("search") != null) {%>
					<input type="hidden" name="search" value="<%=request.getParameter("search")%>">
					
					<% } else if (request.getParameter("pricefrom") != null
								&& request.getParameter("priceto") != null) { %>
					<input type="hidden" name="pricefrom" value="<%=request.getParameter("pricefrom")%>">
					<input type="hidden" name="priceto" value="<%=request.getParameter("priceto")%>">
					
					<% } %>
					
					<label for="sort" style="display:inline-block">Sort by:</label>
				    <select id="sort" name="sort" class="field-sort-filter" onchange="form1.submit()">
				      <option value="popular" selected="selected">most popular</option>
				      <option value="lowest_price"
				      	<%= request.getParameter("sort") != null ?
				      		request.getParameter("sort").equals("lowest_price") ? "selected" : "" : ""%>>
				      	lowest price</option>
				      <option value="highest_price"
				      	<%= request.getParameter("sort") != null ?
				      		request.getParameter("sort").equals("highest_price") ? "selected" : "" : ""%>>
			      		highest price</option>
				    </select>
				    
				</form>
			</div>
			<!-- end selection sort -->
			
			<!-- display total records in per page -->
			<div>
				<p>
				<%=start+1%>
				to
				<%=totalRecords < (p * limit) ?
						totalRecords.intValue() : start + limit %>
				of
				<%=totalRecords.intValue()%> 
				results</p>
			</div>
			<!-- end display total records in per page -->
			
			<!-- show product -->
			<table>
			  <tr>
			    <th>STT</th>
			    <th>Name</th>
			    <th>Quantity</th>
			    <th>Price</th>
		     	<th>Category</th>
		     	<th class="action-column">Action</th>
			  </tr>
			  
			  <% int stt = start + 1; %>
			  <c:forEach items="<%=products %>" var="product">
			  <tr>
			    <td><%=stt++ %></td>
			    <td>${product.name }</td>
			    <td>${product.quantity }</td>
			    <td>
			    	<fmt:formatNumber type="currency">${product.price }
			    	</fmt:formatNumber>
		    	</td>
		    	
		    	<c:forEach items="<%=categorys %>" var="category">
		    		<c:if test="${product.category == category.id }">
		    	<td>${category.name}</td>
		    		</c:if>
			    </c:forEach>
			    
			    <td>
			    	<a href="product/details?id=${product.id }" class="details-button">Details</a>
			    	<a href="product/edit?id=${product.id }" class="edit-button">Edit</a>
			    	<a href="product/delete?id=${product.id }" class="delete-button" 
			    		onclick="return confirm('Bạn có chắc muốn xóa sản phẩm ${product.name} ?')">
			    		Delete</a>
			    </td>
			  </tr>
			  </c:forEach>
	
			</table>
		<!-- end show product -->
		</div>
		
		<!-- pagination -->
		<div class="pagination-frame">
			<form action="" method="get" class="pagination">
			  	<%
			  	String parameter = "";
				if(request.getParameter("category")!=null) {
					parameter += ("category=" + request.getParameter("category") + "&");
					
				} else if (request.getParameter("search") != null) {
					parameter += ("search=" + request.getParameter("search") + "&");
					
				} else if (request.getParameter("pricefrom") != null
							&& request.getParameter("priceto") != null) {
					parameter += ("pricefrom="
									+ request.getParameter("pricefrom") + "&priceto="
									+ request.getParameter("priceto") + "&"
				    );
				}
				
			  	if(request.getParameter("sort") != null) {
			  		parameter += ("sort=" + request.getParameter("sort") +"&");
			  	}
				%>
				
				<a href="?<%=parameter%>page=<%=(p > 1) ? p - 1 : 1 %>">&laquo;</a>
				<%
				int i = 1;
				if(p > i+1) i = p - 2;
			  	if(i > totalPages - 5 && totalPages - 5 > 0) i = totalPages-5;
				int range = (i + 5) >= totalPages ? totalPages : (i+5);
				for(; i <= range; i++) {
				%>
				<a href="?<%=parameter%>page=<%=i%>" 
						<%=(p==i) ? "class='active'" : ""%>><%=i %></a>
				<%
				}
				%>
				<a href="?<%=parameter%>page=<%=(p < totalPages) ? p + 1 : totalPages%>">&raquo;</a>
			</form>
		</div>
		<!-- end pagination -->
		
		<div>
			<a href="product/add" class="add-button">Add</a>
		</div>
		
</div>

</body>
</html>